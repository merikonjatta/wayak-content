<!-- vim: set noexpandtab shiftwidth=4 wrap linebreak filetype=mediawiki: -->
{{#set: title=第3章: カーネルソースの入手}}
{{Nav
|prev=LKN/Chapter2
|next=LKN/Chapter4
}}

= 第3章: カーネルソースの入手 =

自分でカーネルをビルドするなら、最新の安定版を入手しましょう。ディストリビューションにカーネルソースのパッケージが用意されていることは多いですが、最新のものが提供されることはあまりありません。これらのパッケージを利用すると、ディストリビューションで提供されるコンパイラや他のツールとの互換性が確保されているというメリットがありますが（ツール間の互換性の大切さについては{{Link|LKN/Chapter2}}で述べました）、あなたの需要に合う機能やパフォーマンスは得られないかも知れません。最新のカーネル、コンパイラそしてツールを組み合わせればニーズに合った独自の環境を構築できます。この章ではどのカーネルソースをどこから入手するかにフォーカスします。


== ツリーを選ぶ ==

かつてLinuxカーネルはたった2つだけのツリーに分かれていました。"development（開発版）"と"stable（安定版）"です。developmentブランチのバージョン番号は真ん中が奇数、stableブランチのバージョン番号は真ん中が偶数になっていました。たとえば2.5.25はdevelopmentで、2.4.25はstableです。

2.6のリリース時からこの方針は変わりました。2つのツリーを1つにまとめ、2.6系の全てのリリースは、いかなる速度で開発が進んでいたとしても全て「安定版」とする、という方針を取り始めたのです。2.6系のリリースは数ヶ月間隔で行われ、その間にカーネル開発者は新機能を導入し安定性を向上させてきました。さらに、"-stable"ブランチが作られました。ここでは過去のカーネルリリースに対してバグ修正やセキュリティアップデートが施されています。

例で説明しましょう。図3-1を見てください。まず2.6.17が安定版としてリリースされます。次に新機能を付け加えた''-rc''バージョンを開発版としてリリースしていきます。これらの目的は人々に試してもらい、新機能をデバッグするためです。この開発版が十分安定したと開発者の間でコンセンサスがとれたら、2.6.18としてリリースされます。このサイクルにだいたい2〜3ヶ月かかります。

[[File:lkn-fig0301.gif|none|frame|図3-1. カーネル開発のリリースサイクル]]


新機能の開発と同時に、2.6.17.1、2.6.17.2など、バグ修正とセキュリティアップデートを施した安定版が公開されていきました。

単に新しいカーネルを使いたいだけならば、安定版のリリースを使うとよいでしょう。新しい機能をテストしたりバグを発見して報告したりとカーネル開発者を手助けしたいなら、開発版を使うといいでしょう。ここでは安定版を利用することを想定して解説します。


== カーネルソースの入手先 ==

Linuxカーネルのソースコードは全て''kernel.org''のミラーサイトで入手できます。世界中にミラーサイトが置かれていますので近くのサーバからダウンロードできます（メインサーバの負荷も軽減されています）。

メインの http://www.kernel.org/ では、図3-2のように全てのツリーの全てのバージョンがリストアップされています。

[[File:lkn-fig0302.gif|none|frame|図3-2. kernel.orgのメインサイト]]

最新のカーネルバージョンをダウンロードするには、そのバージョンの行にある''F''の文字をクリックします。これでカーネルのソースがまるごとダウンロードされます。もしくは、2.6系のカーネルを含むサブディレクトリ http://www.us.kernel.org/pub/linux/kernel/v2.6/ まで辿って行ってもいいです（図3-3）。

[[File:lkn-fig0303.gif|none|frame|図3-3. カーネル2.6のソースディレクトリ]]

あるいは、ディストリビューションに付属しているであろう''wget''か''curl''を使ってコマンドラインからダウンロードすることもできます。

例えば''wget''でカーネル2.6.17.8をダウンロードするには：
<pre>
$ wget http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.17.8.tar.gz
--17:44:55--  http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.17.8. tar.gz
      => `linux-2.6.17.8.tar.gz'
Resolving www.kernel.org... 204.152.191.5, 204.152.191.37
Connecting to www.kernel.org|204.152.191.5|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 51,707,742 (49M) [application/x-gzip]
100%[=============================================>] 51,707,742	  35.25K/s  ETA 00:00
18:02:48 (47.12 KB/s) - `linux-2.6.17.8.tar.gz' saved [51707742/51707742]
</pre>

''curl''を使う場合は：
<pre>
$ curl http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.17.8.tar.gz \
-o linux-2.6.17.8.tar.gz
% Total	% Received % Xferd Average Speed	Time	Time	Time Current
                            Dload	Upload	Total	Spent	Left
Speed 100 49.3M 100 49.3M	0	0 50298	0 0:17:08 0:17:08 --:--:-- 100k
</pre>

カーネルのバージョンについての説明を見るには、 http://www.kernel.org/kdist/finger_banner にアクセスしてください（図3-4）。

[[File:lkn-fig0304.gif|none|frame|図3-4. 最新のカーネルバージョン]]


== ダウンロードしたソースの扱い ==

ダウンロードしたソースはどこに置けばいいでしょうか。ホームディレクトリに''linux''とでも名付けたディレクトリを作り、そこに置くことをお勧めします。

<pre>
$ mkdir ~/linux
$ mv ~/linux-2.6.17.8.tar.gz ~/linux/
</pre>

''linux''ディレクトリに移動し、ソースツリーを展開します。

<pre>
$ tar -xzvf linux-2.6.17.8.tar.gz
</pre>

展開されたファイルの一覧で画面がいっぱいになります。''linux''ディレクトリの内容は以下のようになっているはずです。

<pre>
$ ls
linux-2.6.17.8.tar.gz
linux-2.6.17.8/
</pre>


<references/>

{{Nav
|prev=LKN/Chapter2
|next=LKN/Chapter4
}}
